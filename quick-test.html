<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>快速测试 Token</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        button { padding: 10px 20px; margin: 10px 0; cursor: pointer; }
        #result { background: #f5f5f5; padding: 20px; border-radius: 5px; white-space: pre-wrap; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>快速测试 Token 访问 API</h1>
    
    <button onclick="quickTest()">一键测试</button>
    <button onclick="clearToken()">清除 Token</button>
    
    <div id="result"></div>

    <script>
        async function quickTest() {
            const resultDiv = document.getElementById('result');
            
            // 1. 获取 token
            const token = localStorage.getItem('token');
            if (!token) {
                resultDiv.innerHTML = '<span class="error">❌ 没有找到 token！\n\n请先访问 OAuth 登录页面进行登录。</span>';
                return;
            }
            
            resultDiv.innerHTML = '正在测试...\n\n';
            resultDiv.innerHTML += `Token: ${token.substring(0, 30)}...\n\n`;
            
            try {
                // 2. 测试 API
                const response = await fetch('http://localhost:3001/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML += '<span class="success">✅ 成功获取用户信息！\n\n</span>';
                    resultDiv.innerHTML += '用户数据:\n' + JSON.stringify(data, null, 2);
                } else {
                    resultDiv.innerHTML += '<span class="error">❌ 获取失败！\n\n</span>';
                    resultDiv.innerHTML += '错误信息:\n' + JSON.stringify(data, null, 2);
                    
                    if (response.status === 401) {
                        resultDiv.innerHTML += '\n\n需要重新登录获取新的 token。';
                    }
                }
            } catch (error) {
                resultDiv.innerHTML += '<span class="error">❌ 请求失败！\n\n</span>';
                resultDiv.innerHTML += '错误: ' + error.message;
            }
        }
        
        function clearToken() {
            localStorage.removeItem('token');
            localStorage.removeItem('refreshToken');
            document.getElementById('result').innerHTML = '✅ Token 已清除，请重新登录。';
        }
        
        // 页面加载时自动测试
        window.onload = quickTest;
    </script>
</body>
</html>